# Approval Check Skill

## Description

This skill is a **mandatory gate in the reasoning loop**. Before the AI Employee executes any MCP action (post, send, delete, pay), it must run this check. If `approval_needed: true`, the task is moved to `/Pending_Approval/[task].md` and execution is halted until a human approves it. No sensitive MCP tool call may proceed without passing this gate.

## Position in Reasoning Loop

```
[Task Identified]
    --> [Plan generated by Plan_Tasks_Skill]
    --> [Ready to Execute?]
    --> ** APPROVAL CHECK (this skill) **
        --> approval_needed: false  --> Execute MCP action
        --> approval_needed: true   --> Move to /Pending_Approval/
                                    --> Update Dashboard.md
                                    --> STOP (wait for human)
```

**This skill runs AFTER planning and BEFORE any MCP tool call.**

---

## Trigger Conditions

Apply this skill **every time** before calling an MCP tool. Specifically:

### Actions Requiring Approval
- **External Posting**: LinkedIn, Twitter, social media, blogs, public announcements
- **Financial Actions**: Payments, transfers, purchases, refunds, billing changes
- **Sensitive Data**: Personal information, credentials, API keys, customer data
- **Destructive Actions**: Deletions, overwrites, system configuration changes (per Rule 2)
- **External Communications**: Emails to clients, official correspondence

### MCP Actions That Always Require Approval
| MCP Tool | Category |
|----------|----------|
| `send_email` | External Communication |
| `post_linkedin` | External Posting |
| `post_twitter` | External Posting |
| `make_payment` | Financial Action |
| `delete_data` | Destructive Action |
| `modify_config` | Destructive Action |

### MCP Actions That Do NOT Require Approval
| MCP Tool | Reason |
|----------|--------|
| `check_email_config` | Read-only, no side effects |

---

## Steps

### Step 1: Intercept Before MCP Execution

Before calling any MCP tool:
1. Identify which `mcp_action` the task requires
2. Check if the action is in the approval-required list above
3. If the action is NOT in the list, proceed to execute — no gate needed
4. If the action IS in the list, continue to Step 2

### Step 2: Update the Task File YAML

Set the following fields in the task's YAML frontmatter:

```yaml
---
status: pending_approval
approval_needed: true
approved: false
mcp_action: ["send_email"]          # the action(s) that triggered the gate
approval_reason: "send_email requires human approval before execution"
awaiting_approval_since: 2026-02-05 23:00:00
---
```

### Step 3: Move Task to /Pending_Approval/

```
Source:  /Needs_Action/[task].md  (or wherever the task currently lives)
Target:  /Pending_Approval/[task].md
```

- If `/Pending_Approval/` does not exist, create it
- Preserve the full file contents (YAML + body)
- The original file is removed from its source location

### Step 4: Update Dashboard.md

Add a row to the **Pending Approval** section of `Dashboard.md`:

```markdown
## Pending Approval

| Task | Action | Flagged | Location |
|------|--------|---------|----------|
| Post Weekly Update | send_email | 2026-02-05 23:00 | [[Pending_Approval/task_weekly_update.md]] |
```

This section makes pending approvals visible at a glance.

### Step 5: Log the Decision

Add entry to `System_Log.md`:

```
| 2026-02-05 23:00 | Approval Gate | Task "Post Weekly Update" requires approval for send_email — moved to Pending_Approval |
```

### Step 6: STOP Execution

**Do NOT call the MCP tool.** The reasoning loop must halt for this task and move on to other work. The task will only be executed after the human approves it and the `Approval_Handler_Skill` picks it up.

---

## How the Human Approves

The human reviews the task in `/Pending_Approval/[task].md` and:

1. **To approve**: Edit the YAML frontmatter to set `approved: true`
   ```yaml
   approved: true
   ```

2. **To reject**: Edit the YAML frontmatter to set `status: rejected`
   ```yaml
   status: rejected
   approved: false
   ```

3. The `Approval_Handler_Skill` will detect the change and act on it.

---

## Example

### Input: Task Ready for Execution
```yaml
---
type: external_communication
status: pending
priority: medium
created_at: 2026-02-05 22:00:00
related_files: ["Inbox/client_notes.txt"]
approval_needed: false
mcp_action: ["send_email"]
---

# Send Summary Email to Client

## Description
Email the client a summary of their project notes.

## Email Details
- To: client@example.com
- Subject: Your Project Notes Summary
- Body: [generated summary]
```

### After Approval Check (moved to /Pending_Approval/)
```yaml
---
type: external_communication
status: pending_approval
priority: medium
created_at: 2026-02-05 22:00:00
related_files: ["Inbox/client_notes.txt"]
approval_needed: true
approved: false
mcp_action: ["send_email"]
approval_reason: "send_email requires human approval before execution"
awaiting_approval_since: 2026-02-05 23:00:00
---

# Send Summary Email to Client
...
```

File location: `/Pending_Approval/task_send_summary_email.md`

Dashboard updated: `Pending Approval: [[Pending_Approval/task_send_summary_email.md]]`

**MCP tool NOT called. Execution halted for this task.**

---

## Integration with Other Skills

| Skill | Relationship |
|-------|-------------|
| `Plan_Tasks_Skill` | Plans identify which tasks will need approval (Batch 2: Needs Approval) |
| `Approval_Handler_Skill` | Picks up approved tasks from `/Pending_Approval/` and executes them |
| `MCP_Action_Logger_Skill` | Logs the MCP action AFTER it is eventually executed (not at gate time) |

---

## Notes

- When in doubt, **always require approval** — err on the side of caution
- The user can configure additional sensitive actions in `Company_Handbook.md`
- This skill is the **only** path to MCP execution for sensitive actions
- Never bypass this gate, even if the user's original request seems urgent
- If a task has multiple MCP actions and any one requires approval, the entire task is gated
